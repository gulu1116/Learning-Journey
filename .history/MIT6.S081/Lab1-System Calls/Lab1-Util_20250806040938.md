
## 一、启动xv6(难度：Easy)

**1. 切换到util分支：**

```bash
cd xv6-riscv-riscv/
git checkout util
```

- 成功：
    ```bash
    branch 'util' set up to track 'origin/util'.
    Switched to a new branch 'util'
    ```

- 失败：
![alt text](lab1-assert/image.png)

  - 解决方法：临时保存当前文件，切分支后再恢复回来
    ```bash
    git add .               # 把所有已跟踪的更改加入缓存区
    git stash push -m "save before switch"   # 保存当前更改到 stash
    git clean -fd           # 删除 untracked 文件
    git checkout util       # 现在可以成功切换分支了
    ```
- 确认一下：

    ```bash
    git branch
    ```
    ```bash
    # 看到
    * util
    ```

**2. 运行 xv6**

```bash
make qemu
```
**按下ctrl+a松开两个键然后再按x退出qemu!**

---

## 二、sleep(难度：Easy)


## 二、sleep（难度：Easy）

**1. 模仿已有程序，如 `/user/echo.c`。可以打开文件看看结构，或者运行：**

```bash
cat user/echo.c
```

可以看到它的结构大致是：

```c
#include "kernel/types.h"
#include "user/user.h"

int
main(int argc, char *argv[])
{
  // 逻辑代码
  exit(0);
}
```

**2. 现在新建 sleep 程序**

```bash
touch user/sleep.c
```

然后编辑它（推荐使用 VSCode 或 vim）：

```bash
vim user/sleep.c
```

```c
#include "kernel/types.h"
#include "user/user.h"

int main(int argc, char *argv[])
{
  if (argc != 2) {
    fprintf(2, "Usage: sleep <time>\n");
    exit(1);
  }

  int time = atoi(argv[1]);
  sleep(time);

  exit(0);
}
```

- `argc` 是参数个数，`argv[1]` 是从 shell 输入的时间。
- `atoi`：把字符串转为整数。
- `sleep(time)`：调用系统调用。
- `exit()`：程序正确退出。
    

**3. 将 sleep 添加到 Makefile**

编辑 Makefile 文件：

```bash
vim Makefile
```

找到 `UPROGS`（大概在 220 行附近），**在末尾加上：**

```make
  $U/_sleep\
```

**4. 编译并运行测试**

```bash
make qemu
```

如果编译没有报错，进入 shell 后测试：

```bash
sleep 10
```

程序会暂停一会儿然后退出，说明成功。

**5. 自动化测试 sleep 程序**

退出 qemu（在 qemu 窗口按 `Ctrl+A`，然后 `X` 退出），然后运行：

```bash
./grade-lab-util sleep
```

或者：

```bash
make GRADEFLAGS=sleep grade
```
---


